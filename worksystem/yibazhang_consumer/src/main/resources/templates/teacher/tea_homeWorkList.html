<!DOCTYPE html>
<html lang="en"  xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link th:href="@{/static/layui/css/layui.css}" rel="stylesheet">
    <script th:src="@{/static/js/jquery.js}"></script>
    <script th:src="@{/static/layui/layui.js}"></script>
    <style type="text/css">
        .layui-elem-field {
            background-color: #f2f2f2;
            width: 700px;
            margin-right: auto;
            margin-left: auto;
            padding:40px;
        }
        .boder-class{
            border-radius: 10px;
            border: 2px solid skyblue;
        }
    </style>
</head>
<body>
<div style="margin-left:50px;margin-top: 30px">
    <fieldset class="layui-elem-field boder-class" style="margin-top: 30px;width: 888px;">
        <form class="layui-form" >
            <div class="layui-form-item">
                <div class="layui-input-inline" style="width: 350px">
                    <label class="layui-form-label">查询条件：</label>
                    <div class="layui-input-inline">
                        <select name="selType" lay-filter="nextQueryProject">
                            <option value="-1">--请选择--</option>
                            <option value="0">作业编号</option>
                            <option value="1">作业名称</option>
                            <option value="2">课程编号</option>
                            <option value="3">课程名称</option>
                        </select>
                    </div>
                </div>
                <div class="layui-input-inline" style="margin-left: -50px">
                    <input id="queryKeyword" type="text" name="selVal"   placeholder="请输入查询关键字" autocomplete="off" class="layui-input layui-disabled" disabled>
                </div>
                <div class="layui-input-inline" style="margin-left: -50px;width: 350px">
                    <label class="layui-form-label">状态</label>
                    <div class="layui-input-inline">
                        <select name="hStatus">
                            <option value="-1">--请选择--</option>
                            <option value="0">已上传</option>
                            <option value="1">已发放</option>
                            <option value="2">已结束</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="layui-form-item" >
                <div class="layui-inline" >
                    <label class="layui-form-label">作业时间:</label>
                    <div class="layui-input-inline">
                        <input type="text" name="hStarttime" placeholder="开始时间" id="startTime" autocomplete="off"
                               class="layui-input">
                    </div>
                    <div class="layui-form-mid">-</div>
                    <div class="layui-input-inline">
                        <input type="text" name="hEndtime" placeholder="结束时间" id="endTime" autocomplete="off"
                               class="layui-input">
                    </div>
                </div>
                <div class="layui-input-block " style="float: right;margin-right: 130px">
                    <button type="button" class="layui-btn" lay-submit lay-filter="*">查询</button>
                </div>
            </div>
        </form>
    </fieldset>
    <fieldset class="layui-elem-field boder-class" style="margin-top: 10px;">
        <legend>作业信息</legend>
        <table class="layui-hide" id="homeworkTable" lay-filter="homeworkTable"></table>
    </fieldset>
</div>
<script th:inline="none">
    layui.use(['table', 'layer','form','laydate'], function(){
        var table = layui.table
            ,$=layui.$
            ,layer=layui.layer
            ,form=layui.form
            ,laydate=layui.laydate;



        laydate.render({
            elem: '#startTime'
            ,type: 'datetime'
        });
        laydate.render({
            elem: '#endTime'
            ,type: 'datetime'
        });

        form.on('select(nextQueryProject)',function (data) {
            if (data.value=='-1') {
                $('#queryKeyword').val('').addClass('layui-disabled').attr('disabled',true);
            }else {
                $('#queryKeyword').val('').removeAttr('disabled').removeClass('layui-disabled');
            }
        });



        //第一个实例
        var homeworkTable = table.render({
            elem: '#homeworkTable'
            ,height: 350
            ,width:888
            ,skin:'row'
            ,even:true
            ,toolbar:'#toolbar'
            ,url: '/homework/teaSelectHomeWork' //数据接口
            , loading: true
            , text:{none:'没有查到更多数据～'}
            ,page: true //开启分页
            ,id:'teaTable'
            ,cols: [[ //表头
                {type: 'checkbox', fixed: 'left'}
                ,{field: 'hId', title: '作业编号', width:180,align:'center'}
                ,{field: 'hName', title: '作业名称', width:160,align:'center'}
                ,{field: 'crId', title: '课程编号', width:100,align:'center'}
                ,{field: 'crName', title: '课程名称', width:140,align:'center'}
                ,{field: 'hUptime', title: '作业上传时间', width:160,align:'center'}
                ,{field: 'hStarttime', title: '作业发放时间', width:160,align:'center'}
                ,{field: 'hEndtime', title: '作业结束时间', width:160,align:'center'}
                ,{field: 'hStatus', title: '作业状态', width:120,align:'center',templet: function (d) {
                    var startTime = new Date(d.hStarttime);
                    var endTime = new Date(d.hEndtime);
                    var upTime = new Date(d.hUptime);
                    var today = new Date();
                    var res="";
                    if(upTime<today&&today<startTime){
                        res="已上传";
                    }else if(startTime<today&&today<endTime){
                        res="已发放";
                    }else if(today>endTime){
                        res="已结束";
                    }
                    return res;
                }}
                ,{fixed: 'right', title:'操作', toolbar: '#bar', width:150}
            ]]
        });

        form.on('submit(*)',function (data) {
            var reg = new RegExp("^[0-9]*$");
            if(data.field.selType==0||data.field.selType==2){
                var temp = data.field.selVal;
                if(!reg.test(temp)){
                    layer.msg("请输入数字",{icon:5})
                    return;
                }
            }
            console.log(data.field.selType);
            homeworkTable.reload({
                url:'/homework/teaSelectHomeWork',
                where:data.field,
                page:{
                    curr:1
                }
            });
        });

        table.on('toolbar(homeworkTable)', function(obj){
            var checkStatus = table.checkStatus(obj.config.id);
            switch(obj.event){
                case 'getCheckData':
                    var data = checkStatus.data;
                    var ids="";
                    var names="";
                    $.each(data,function(){
                        ids+=this.tId+",";
                        names+=this.tName+",";
                    });
                    ids=ids.substring(0,ids.length-1);
                    names=names.substring(0,names.length-1);
                    if(ids==''){
                        layer.msg("请选择要删除的用户！");
                    }else{
                        layer.confirm('确定要删除【'+names+'】的信息吗？', {
                            btn: ['确定','不了，不了'] //按钮
                        }, function(){
                            $.ajax({
                                url:'${APP_PATH}/admin/students/delStudent?ids='+ids,
                                type:'GET',
                                success:function(result){
                                    layer.msg(result.msg,function(){
                                        location.reload();
                                    });
                                }
                            });
                        }, function(){
                            layer.msg('你考虑好再来');
                        });
                    };
                    //layer.alert(JSON.stringify(data));
                    break;
                case 'addInfo':
                    window.location.href="/teacher/hwAdd"
                    break;
            };
        });
    });
</script>
<!--工具栏-->
<script type="text/html" id="toolbar">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-radius layui-btn-danger" lay-event="getCheckData">批量删除</button>
        <button class="layui-btn layui-btn-radius layui-btn-normal" lay-event="addInfo">上传作业</button>
    </div>
</script>
<script type="text/html" id="bar">
    <a class="layui-btn layui-btn-xs layui-btn-radius" lay-event="edit">修改</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs layui-btn-radius" lay-event="del">删除</a>
</script>
</body>
</html>